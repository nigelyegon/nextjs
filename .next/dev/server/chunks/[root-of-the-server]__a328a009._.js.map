{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///home/nigel/Documents/eCitizen/Projects/nextjs/nextjs/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\n\nexport const db = mysql.createPool({\n  host: process.env.DB_HOST,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_NAME,\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,KAAK,8IAAK,CAAC,UAAU,CAAC;IACjC,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;AAC/B"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///home/nigel/Documents/eCitizen/Projects/nextjs/nextjs/app/api/auth/login/route.js"],"sourcesContent":["// import { db } from \"@/lib/db\";\n// import bcrypt from \"bcryptjs\";\n// import jwt from \"jsonwebtoken\";\n// import { NextResponse } from \"next/server\";\n\n// export async function POST(req) {\n//   try {\n//     const { email, password, remember } = await req.json();\n\n//     if (!email || !password) {\n//       return NextResponse.json({ error: \"Email and password required\" }, { status: 400 });\n//     }\n\n//     const normalizedEmail = email.trim().toLowerCase();\n//     const [rows] = await db.query(\"SELECT * FROM users WHERE email = ?\", [normalizedEmail]);\n\n//     if (!rows.length) return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n\n//     const user = rows[0];\n//     const isMatch = await bcrypt.compare(password, user.password);\n\n//     if (!isMatch) return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n\n//     // ✅ Generate JWTs\n//     const accessToken = jwt.sign({ id: user.id, email: user.email }, process.env.JWT_SECRET, {\n//       expiresIn: parseInt(process.env.ACCESS_TOKEN_EXPIRES), // e.g., 900 = 15min\n//     });\n\n//     const refreshToken = jwt.sign({ id: user.id }, process.env.JWT_REFRESH_SECRET, {\n//       expiresIn: remember\n//         ? parseInt(process.env.REMEMBER_ME_EXPIRES) // e.g., 30 days\n//         : parseInt(process.env.REFRESH_TOKEN_EXPIRES), // e.g., 7 days\n//     });\n\n//     // ✅ Set cookies\n//     const res = NextResponse.json({ message: \"Logged in successfully\" });\n\n//     res.cookies.set({\n//       name: \"accessToken\",\n//       value: accessToken,\n//       httpOnly: true,\n//       path: \"/\",\n//       maxAge: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n//     });\n\n//     res.cookies.set({\n//       name: \"refreshToken\",\n//       value: refreshToken,\n//       httpOnly: true,\n//       path: \"/api/auth/refresh\",\n//       maxAge: remember\n//         ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n//         : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n//     });\n\n//     return res;\n//   } catch (err) {\n//     console.error(\"Login API error:\", err);\n//     return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n//   }\n// }\nimport { db } from \"@/lib/db\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(req) {\n  try {\n    const { email, password, remember } = await req.json();\n    if (!email || !password) {\n      return NextResponse.json({ error: \"Email and password required\" }, { status: 400 });\n    }\n\n    const normalizedEmail = email.trim().toLowerCase();\n    const [rows] = await db.query(\"SELECT * FROM users WHERE email = ?\", [normalizedEmail]);\n    if (!rows.length) return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n\n    const user = rows[0];\n    const isMatch = await bcrypt.compare(password, user.password);\n    if (!isMatch) return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n\n    const accessToken = jwt.sign({ id: user.id, email: user.email }, process.env.JWT_SECRET, {\n      expiresIn: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n    });\n\n    const refreshToken = jwt.sign({ id: user.id }, process.env.JWT_REFRESH_SECRET, {\n      expiresIn: remember\n        ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n        : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n    });\n\n    // ✅ Use NextResponse.redirect to send user directly to dashboard\n    const res = NextResponse.redirect(new URL(\"/dashboard\", req.url));\n\n    res.cookies.set({\n      name: \"accessToken\",\n      value: accessToken,\n      httpOnly: true,\n      path: \"/\",\n      maxAge: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n    });\n\n    res.cookies.set({\n      name: \"refreshToken\",\n      value: refreshToken,\n      httpOnly: true,\n      path: \"/api/auth/refresh\",\n      maxAge: remember\n        ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n        : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n    });\n\n    return res;\n  } catch (err) {\n    console.error(\"Login API error:\", err);\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}