{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///home/nigel/Documents/eCitizen/Projects/nextjs/nextjs/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\n\nexport const db = mysql.createPool({\n  host: process.env.DB_HOST,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_NAME,\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,KAAK,8IAAK,CAAC,UAAU,CAAC;IACjC,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;AAC/B"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///home/nigel/Documents/eCitizen/Projects/nextjs/nextjs/app/api/auth/register/route.js"],"sourcesContent":["// import { db } from \"@/lib/db\";\n// import bcrypt from \"bcryptjs\";\n// import jwt from \"jsonwebtoken\";\n// import { NextResponse } from \"next/server\";\n\n// export async function POST(req) {\n//   try {\n//     const { name, email, password, remember } = await req.json();\n\n//     if (!name || !email || !password) {\n//       return NextResponse.json({ error: \"Name, email, and password are required\" }, { status: 400 });\n//     }\n\n//     const normalizedEmail = email.trim().toLowerCase();\n\n//     // Check if user already exists\n//     const [existing] = await db.query(\"SELECT id FROM users WHERE email = ?\", [normalizedEmail]);\n//     if (existing.length) {\n//       return NextResponse.json({ error: \"Email already registered\" }, { status: 409 });\n//     }\n\n//     // Hash password\n//     const hashedPassword = await bcrypt.hash(password, 10);\n\n//     // Insert user into DB\n//     const [result] = await db.query(\n//       \"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\",\n//       [name, normalizedEmail, hashedPassword]\n//     );\n\n//     const userId = result.insertId;\n\n//     // ✅ Generate JWTs\n//     const accessToken = jwt.sign({ id: userId, email: normalizedEmail }, process.env.JWT_SECRET, {\n//       expiresIn: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n//     });\n\n//     const refreshToken = jwt.sign({ id: userId }, process.env.JWT_REFRESH_SECRET, {\n//       expiresIn: remember\n//         ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n//         : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n//     });\n\n//     // ✅ Set cookies\n//     const res = NextResponse.json({ message: \"Registered and logged in successfully\" });\n\n//     res.cookies.set({\n//       name: \"accessToken\",\n//       value: accessToken,\n//       httpOnly: true,\n//       path: \"/\",\n//       maxAge: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n//     });\n\n//     res.cookies.set({\n//       name: \"refreshToken\",\n//       value: refreshToken,\n//       httpOnly: true,\n//       path: \"/api/auth/refresh\",\n//       maxAge: remember\n//         ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n//         : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n//     });\n\n//     return res;\n//   } catch (err) {\n//     console.error(\"Register API error:\", err);\n//     return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n//   }\n// }\nimport { db } from \"@/lib/db\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(req) {\n  try {\n    const { name, email, password, remember } = await req.json();\n    if (!name || !email || !password) {\n      return NextResponse.json({ error: \"Name, email, and password required\" }, { status: 400 });\n    }\n\n    const normalizedEmail = email.trim().toLowerCase();\n    const [existing] = await db.query(\"SELECT id FROM users WHERE email = ?\", [normalizedEmail]);\n    if (existing.length) return NextResponse.json({ error: \"Email already registered\" }, { status: 409 });\n\n    const hashedPassword = await bcrypt.hash(password, 10);\n    const [result] = await db.query(\n      \"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\",\n      [name, normalizedEmail, hashedPassword]\n    );\n\n    const userId = result.insertId;\n\n    const accessToken = jwt.sign({ id: userId, email: normalizedEmail }, process.env.JWT_SECRET, {\n      expiresIn: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n    });\n\n    const refreshToken = jwt.sign({ id: userId }, process.env.JWT_REFRESH_SECRET, {\n      expiresIn: remember\n        ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n        : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n    });\n\n    // ✅ Redirect directly to dashboard after registration\n    const res = NextResponse.redirect(new URL(\"/dashboard\", req.url));\n\n    res.cookies.set({\n      name: \"accessToken\",\n      value: accessToken,\n      httpOnly: true,\n      path: \"/\",\n      maxAge: parseInt(process.env.ACCESS_TOKEN_EXPIRES),\n    });\n\n    res.cookies.set({\n      name: \"refreshToken\",\n      value: refreshToken,\n      httpOnly: true,\n      path: \"/api/auth/refresh\",\n      maxAge: remember\n        ? parseInt(process.env.REMEMBER_ME_EXPIRES)\n        : parseInt(process.env.REFRESH_TOKEN_EXPIRES),\n    });\n\n    return res;\n  } catch (err) {\n    console.error(\"Register API error:\", err);\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}